---
author: Carlo Salaroglio
document_type: Document
email: salaroglio@hotmail.com
title: 
date: 21/08/2025
word_section:
  write_toc: false
  document_header: ''
  template_section:
    inherit_from_template: ''
    custom_template: ''
    template_type: default
  predefined_pages: 
---
# 2025-06-02 Sprint

## 📊 Tabella Riassuntiva

| Stato | Attività                                        | Link                     |
| ----- | ----------------------------------------------- | ------------------------ |
| ⬜     | Implementare evento Deleted                     | [↗](#evento-deleted)     |
| ⬜     | Migliorare evento Renamed                       | [↗](#evento-renamed)     |
| ✅     | Fix problema indicizzazione                     | [↗](#fix-indicizzazione) |
| ✅     | Fix aggiornamento modifiche file                | [↗](#fix-modifiche)      |
| 🔥    | **Fix Rule #1 file rinominato non indicizzato** | [↗](#fix-rule1)          |
| ⬜     | Nuovi listener SignalR frontend                 | [↗](#listener-signalr)   |
| ⬜     | Handler rimozione/rinomina nodi                 | [↗](#handler-frontend)   |
| ⬜     | Test creazione file                             | [↗](#test-creazione)     |
| ⬜     | Test rinominazione file                         | [↗](#test-rinominazione) |
| ⬜     | Test cancellazione file                         | [↗](#test-cancellazione) |
| ⬜     | Performance testing                             | [↗](#performance-test)   |
| ⬜     | Edge cases testing                              | [↗](#edge-cases)         |

## 🎯 Obiettivo Sprint: File System Monitoring Completo

**Focus**: Implementare e testare il riconoscimento automatico completo di tutte le operazioni sui file Markdown tramite FileSystemWatcher.

### 📋 Stato di Partenza

Dal sprint precedente (2025-06-01) abbiamo:

* ✅ Implementato rilevamento creazione file (Created + Renamed)
* ✅ Implementato comunicazione SignalR real-time
* ✅ Implementato inserimento dinamico nel treeview
* ❌ **Problema aperto**: Stato indicizzazione non riconosciuto correttamente

## 🔧 Task Principali

### 1. **Completamento Gestione Eventi FileSystemWatcher**

**Punto di gestione**: `MonitorMDHostedService.cs`

#### 1.1 Implementare Evento Deleted {#evento-deleted}

* [ ] Abilitare `_fileSystemWatcher.Deleted += _fileSystemWatcher_Deleted`
* [ ] Implementare metodo `_fileSystemWatcher_Deleted` per rimozione file `.md`
* [ ] Inviare evento SignalR `markdownFileDeleted` con:
  ```C#
  {
    name: fileName,
    fullPath: deletedPath,
    path: relativePath,
    action: "deleted"
  }
  ```

#### 1.2 Migliorare Evento Renamed {#evento-renamed}

* [ ] Gestire rinominazione file `.md` → `.md` (cambio nome)
* [ ] Gestire rinominazione file `.md` → altra estensione (rimozione)
* [ ] Inviare eventi appropriati:
  * `markdownFileRenamed` per rinominazioni interne
  * `markdownFileDeleted` per rinominazioni che rimuovono `.md`

#### 1.3 Ottimizzare Evento Created

* [ ] Verificare gestione file creati direttamente come `.md`
* [ ] Testare comportamento con diversi editor (VS Code, Notepad++, etc.)

### 2. **Frontend: Gestione Eventi Completa**

**File coinvolti**:

* `server-messages.service.ts`
* `md-tree.component.ts`

#### 2.1 Nuovi Listener SignalR {#listener-signalr}

* [ ] Implementare `addMarkdownFileDeletedListener`
* [ ] Implementare `addMarkdownFileRenamedListener`

#### 2.2 Handlers Frontend {#handler-frontend}

* [ ] `handleMarkdownFileDeleted` - rimuovere nodo dall'albero
* [ ] `handleMarkdownFileRenamed` - aggiornare nodo esistente
* [ ] Gestire aggiornamento struttura gerarchica per rinominazioni

### 3. **Risoluzione Problemi Aperti**

**Priorità Alta**: Risolvere i problemi critici identificati

#### 3.1 Investigazione Root Cause {#fix-indicizzazione}

* [x] Analizzare metodo `mdFileService.addNewFile()`
* [x] Verificare preservazione proprietà `isIndexed` e `indexingStatus`
* [x] Tracciare flusso dati dal SignalR al template

**✅ RISOLTO**: Modificato `addNewFile` e `recursiveSearchFolder` per preservare le proprietà di indicizzazione

#### 3.2 Soluzioni Alternative

* [ ] **Opzione A**: Fix del servizio `addNewFile`
* [ ] **Opzione B**: Bypass del servizio per inserimento diretto
* [ ] **Opzione C**: Refactoring logica `isFileIndexed`
* [ ] **Opzione D**: Implementazione refresh esplicito

#### 3.3 Testing Specifico

* [ ] Testare con file in root directory
* [ ] Testare con file in sottocartelle
* [ ] Verificare comportamento con file già esistenti

#### 3.4 Fix Aggiornamento Modifiche File {#fix-modifiche}

* [x] Abilitare `NotifyFilters.LastWrite` nel FileSystemWatcher
* [x] Correggere filtro che escludeva file `.md` nell'evento Changed
* [x] Fix property mapping uppercase/lowercase nel frontend
* [x] Aggiungere logging per debug

**✅ RISOLTO**:

* Backend ora rileva correttamente le modifiche ai file markdown
* Frontend aggiorna automaticamente il contenuto quando un file viene modificato
* Testato e confermato funzionante

#### 3.5 Fix Rule #1 File Rinominato Non Indicizzato {#fix-rule1}

**🔥 PRIORITÀ ALTA** - Problema critico che compromette l'esperienza utente

**Contesto**:

* Rule #1 verifica che nome file = primo titolo H1 (es. `# Titolo` → `Titolo.md`)
* Quando l'utente conferma la rinominazione, il file viene rinominato ma appare non indicizzato
* Root cause: `changeDataStoreMdFiles` non preserva `isIndexed`/`indexingStatus`

**Step di Fix**:

* [ ] **Step 1**: Modificare `changeDataStoreMdFiles` per preservare proprietà indicizzazione
* [ ] **Step 2**: Aggiungere deduplicazione eventi in `handleNewMarkdownFileCreated`
* [ ] **Step 3**: Aggiornare tracking BehaviorSubject per file rinominati

**Test Plan**:

* [ ] Test scenario base: file root con Rule #1
* [ ] Test file in sottocartelle
* [ ] Test edge cases (caratteri speciali, titoli lunghi)
* [ ] Test regressione funzionalità esistenti

**Criteri di Successo**:

* ✅ File rinominato tramite Rule #1 immediatamente cliccabile
* ✅ Nessuna opacità ridotta o cursore "not-allowed"
* ✅ Stato `isIndexed = true` preservato
* ✅ Nessun doppio inserimento nel tree

**Documentazione**: Strategia completa in `Rule1-Fix-Strategy.md`

### 4. **Test End-to-End Completi**

#### 4.1 Scenari di Test - Creazione {#test-creazione}

* [ ] **Windows Explorer**: Nuovo → Documento di testo → Rinomina a `.md`
* [ ] **VS Code**: File → New File → Salva come `.md`
* [ ] **Notepad++**: File → New → Salva come `.md`
* [ ] **Interface Angular**: Right-click → Create new document
* [ ] **File diretto**: Crea file `.md` direttamente

#### 4.2 Scenari di Test - Rinominazione {#test-rinominazione}

* [ ] **Cambio nome**: `file1.md` → `file2.md`
* [ ] **Cambio estensione**: `file.md` → `file.txt` (dovrebbe rimuovere dall'albero)
* [ ] **Aggiunta estensione**: `file` → `file.md` (dovrebbe aggiungere all'albero)

#### 4.3 Scenari di Test - Cancellazione {#test-cancellazione}

* [ ] **Delete da Windows Explorer**
* [ ] **Delete da VS Code**
* [ ] **Delete da Interface Angular** (se implementato)

#### 4.4 Scenari di Test - Struttura Gerarchica

* [ ] File in sottocartelle (`docs/readme.md`)
* [ ] File con percorsi complessi (`project/docs/api/endpoints.md`)
* [ ] Cartelle con spazi e caratteri speciali

### 5. **Performance e Edge Cases**

#### 5.1 Performance Testing {#performance-test}

* [ ] Testare con creazione massiva di file (10+ simultanei)
* [ ] Verificare memory leaks con molti eventi SignalR
* [ ] Testare comportamento durante indicizzazione progetto

#### 5.2 Edge Cases {#edge-cases}

* [ ] File con nomi molto lunghi
* [ ] File con caratteri Unicode/emoji
* [ ] Operazioni rapide consecutive (crea-rinomina-cancella)
* [ ] Operazioni su file temporaneamente bloccati

### 6. **Logging e Diagnostica**

#### 6.1 Backend Logging

* [ ] Aggiungere metriche di performance per eventi FileSystemWatcher
* [ ] Logging dettagliato per debug edge cases
* [ ] Contatori per tipi di eventi processati

#### 6.2 Frontend Logging

* [ ] Dashboard di monitoraggio eventi in console
* [ ] Metriche di latenza SignalR
* [ ] Tracking stato sincronizzazione albero

## 📊 Criteri di Accettazione

### Must Have

* [x] **Creazione file**: Funzionante ✅ (già implementato)
* [ ] **Cancellazione file**: File rimossi dall'albero automaticamente
* [ ] **Rinominazione file**: Nodi aggiornati in tempo reale
* [ ] **Stato indicizzazione**: File appena creati cliccabili immediatamente

### Should Have

* [ ] **Performance**: < 500ms latenza per aggiornamenti UI
* [ ] **Robustezza**: Gestione graceful di 10+ operazioni simultanee
* [ ] **UX**: Notifiche appropriate per ogni tipo di operazione

### Could Have

* [ ] **Undo operations**: Possibilità di annullare operazioni
* [ ] **Conflict resolution**: Gestione conflitti per operazioni simultanee
* [ ] **Bulk operations**: Gestione operazioni su gruppi di file

## 🔄 Definition of Done

* [ ] Tutti gli eventi FileSystemWatcher implementati e testati
* [ ] Test end-to-end passano per tutti gli scenari
* [ ] Performance requirements soddisfatti
* [ ] Problema indicizzazione risolto definitivamente
* [ ] Documentazione aggiornata
* [ ] Zero memory leaks o problemi di performance
* [ ] Logging completo per debugging futuro

## 📝 Note Tecniche

### Architettura Eventi

```
FileSystemWatcher → MonitorMDHostedService → SignalR → Angular
     ↓                       ↓                 ↓        ↓
  OS Events            Filter & Process    Broadcast  Update UI
```

### Eventi SignalR da Implementare

* `markdownFileCreated` ✅ (implementato)
* `markdownFileDeleted` ❌ (da implementare)
* `markdownFileRenamed` ❌ (da implementare)

### File Chiave da Modificare

* `MonitorMDHostedService.cs` (punto focale)
* `server-messages.service.ts` (nuovi listener)
* `md-tree.component.ts` (nuovi handler)

## 🚀 Deliverable Finali

1. **Sistema di monitoring completo** per tutti i tipi di operazioni sui file
2. **UI reattiva** che riflette istantaneamente le modifiche del filesystem
3. **Architettura robusta** pronta per essere estesa
4. **Documentazione completa** per manutenzione futura

**Obiettivo**: Trasformare mdExplorer in un sistema completamente reattivo alle modifiche del filesystem, fornendo un'esperienza utente fluida e moderna.
